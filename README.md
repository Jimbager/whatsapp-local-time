# WhatsApp 时区显示器 Chrome 插件 🌍

## 功能介绍

这是一个 Chrome 浏览器插件，可以**自动识别 WhatsApp Web 聊天中的联系人国家/地区**，并在聊天界面中直接显示他们所在地区的当地时间。非常适合需要与不同时区客户沟通的业务人员使用。

## 主要特性

- 🕐 自动时间显示 - 在联系人名称旁/下方直接显示当地时间
- 🌏 数据驱动 - 使用仓库中的 `countries.json` 作为国家数据来源（含两/三位代码、UTC 偏移、电话区号与中文别称数组）
- 🔍 智能识别 - 识别优先级：中文名称(含别称，按长度从长到短) > 三位代码 > 两位代码(严格边界) > 带“+”区号 > 中文顺序模糊兜底
- 🀄 中文别称 - 支持同一国家多种中文写法（如“印尼/印度尼西亚”），避免“印度尼西亚”误判为“印度”
- 🧭 兜底匹配 - 中文顺序模糊匹配（最低优先级），按顺序命中最多字符选取
- 🎛️ 弹窗分栏 - 弹窗包含“功能 / 说明 / 国家列表”三大 Tab
- 🔎 列表搜索 - 在“国家列表”中可按中文名/别称/两三位代码/时区/区号搜索，搜索框置顶(sticky)
- ⚡ 实时更新 - 每分钟自动更新时间显示

## 工作原理

1. 插件会自动扫描 WhatsApp 聊天界面中的联系人名称
2. 解析逻辑顺序：
   - 中文名称/别称（按长度从长到短）
   - 三位国家代码（独立词）
   - 两位国家代码（独立词，严格边界，避免 ACNF→CN 误判）
   - 联系人名称中的“+”电话区号（最长前缀优先）
   - 中文顺序模糊兜底（最低优先级）
3. 匹配成功后在姓名附近插入时间元素，按 UTC 偏移显示当地时间
4. 时间每分钟自动更新，并以 🟢/🔴 展示工作时段状态

## 支持的国家和地区

- 详见 `countries.json`（本扩展加载该文件作为数据源）
- 弹窗 → “国家列表” Tab 可直接查看并搜索

## 安装说明

### 开发者模式安装（推荐）

1. 下载本项目到本地
2. 打开 Chrome，访问 `chrome://extensions/`，开启“开发者模式”
3. 选择“加载已解压的扩展程序”，指向项目根目录
4. 打开 https://web.whatsapp.com/ 即可使用

## 使用方法

- 浏览器工具栏点击扩展图标，进入弹窗：
  - “功能”Tab：启用/禁用开关
  - “说明”Tab：快速使用指南
  - “国家列表”Tab：查看/搜索支持的国家数据（来源 `countries.json`）

## 文件结构（关键）

```
whatsapp-local-time/
├── manifest.json       # 扩展配置（v1.2.0）
├── popup.html/css/js   # 弹窗UI（Tab、搜索、列表渲染）
├── content.js          # 核心逻辑（解析优先级、插入渲染、调试日志）
├── content.css         # 注入样式
├── background.js       # 后台脚本
├── countries.json      # 数据源：中文名(数组)/code2/code3/UTC/phone_code
└── icons/              # 图标
```

## 技术要点

- 使用 `chrome.runtime.getURL('countries.json')` 加载数据
- 为每个中文名/别称建立同一时差条目，键即为中文名/别称
- 解析命中返回 matchedName，优先用 matchedName 作为展示键
- 未命中时标记元素 `data-timezone-failed`，避免重复尝试

## 版本历史

- v1.2.0
  - 数据改为 `countries.json` 驱动；支持中文别称数组
  - 名称匹配按“长 → 短”；新增中文顺序模糊兜底
  - 修复 IANA 为空时报错，改用 UTC 偏移兜底
  - 列表 UI 新增搜索框（sticky）与 Tab 重构
- v1.1.x
  - 增强电话区号与代码识别，修复多处问题
- v1.0
  - 初始版本

## 隐私

- 全部本地执行，不上传任何数据

## 许可证

- 仅供学习与个人使用
